	assume	adl=1

	section	.text

	public	_truncf, _trunc

_trunc:
_truncf:
	ld	hl, 6
	add	hl, sp
	ld	e, (hl)
	dec	hl
	ld	a, (hl)
	dec	hl
	dec	hl
	ld	hl, (hl)
	rla
	ld	a, e
	rla

	sub	a, 127	; exponent bias
	jr	c, .ret_zero
	sub	a, 23	; bits in the mantissa
	ret	nc	; already (large) integer, inf, or NaN
	push	hl
	sbc	hl, hl	; HL = 0xFFFFFF
	neg
	ld	c, a
	call	__ishl
	pop	bc
	jp	__iand

.ret_zero:
	; return signed zero
	ld	a, e
	and	a, $80
	ld	e, a
	sbc	hl, hl
	ret

	extern	__ishl
	extern	__iand
